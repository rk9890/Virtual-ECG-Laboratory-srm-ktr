<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Biomedical Equipments for Clinical Applications Virtual Lab - ECG Augmented Leads</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Chart.js & InteractJS -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/interactjs@1.10.11/dist/interact.min.js"></script>
    <style>
      /* your full CSS - unchanged, keep as is */
      /* ... */
    </style>
</head>
<body>
    <header>
        <h1>Department of Biomedical Engineering SRM KTR</h1>
        <p>Biomedical Equipments for Clinical Applications Virtual Lab</p>
    </header>
    <div class="container">
        <!-- Pretest ... unchanged ... -->
        <!-- ... -->

        <div class="lab" id="labSection">
            <div class="section">
                <h2>Aim</h2>
                <p>To understand and simulate the augmented leads (aVR, aVL, aVF) in ECG monitoring, learn their derivation, and analyze normal ECG patterns through interactive virtual experimentation.</p>
            </div>

            <div class="section">
                <h2>Theory</h2>
                <p>Augmented leads are unipolar leads that provide a view of the heart's electrical activity from specific points. aVR is from the right arm, aVL from the left arm, and aVF from the left foot. They are derived by amplifying the voltage difference between the electrode and the average of the other two limb electrodes. The amplification factor is 3 for better visualization.</p>
            </div>

            <div class="section">
                <h2>Procedure</h2>
                <ol>
                    <li>Complete the pretest to assess your knowledge.</li>
                    <li>Click "Start Virtual Lab" to begin.</li>
                    <li>Drag and place the ECG leads (RA, LA, LF) on the human body diagram.</li>
                    <li>Observe the simulated ECG waveforms for aVR, aVL, and aVF in the graphs below.</li>
                    <li>Note the characteristics in the Observations section.</li>
                    <li>Use the Print Graph button to save or print the output.</li>
                </ol>
            </div>

            <div class="section">
                <h2>Demo Video: How to Connect ECG Leads</h2>
                <div class="video-section">
                    <iframe src="https://www.youtube.com/embed/gdaY8D5xAhM" title="How to Connect ECG Leads" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    <p>Philips: How to attach ECG electrodes - demo video</p>
                </div>
            </div>

            <div class="section">
                <h2>Simulation</h2>
                <p>Drag the leads (RA: Right Arm, LA: Left Arm, LF: Left Foot) to their positions on the human body.</p>
                <div class="human-body">
                    <div class="drop-zone ra" data-zone="ra"></div>
                    <div class="drop-zone la" data-zone="la"></div>
                    <div class="drop-zone lf" data-zone="lf"></div>
                    <div class="lead" id="lead-ra" data-lead="ra">RA</div>
                    <div class="lead" id="lead-la" data-lead="la">LA</div>
                    <div class="lead" id="lead-lf" data-lead="lf">LF</div>
                </div>
                <div class="graphs">
                    <div class="graph-container">
                        <canvas id="chart-aVR"></canvas>
                        <h4>aVR</h4>
                    </div>
                    <div class="graph-container">
                        <canvas id="chart-aVL"></canvas>
                        <h4>aVL</h4>
                    </div>
                    <div class="graph-container">
                        <canvas id="chart-aVF"></canvas>
                        <h4>aVF</h4>
                    </div>
                </div>
                <button class="print-btn" onclick="window.print()">Print Graphs</button>
            </div>
            <div class="section">
                <h2>Observations</h2>
                <p id="observations">Place the leads to generate observations. aVR: Negative QRS complex. aVL: Positive QRS. aVF: Positive QRS with inferior emphasis.</p>
            </div>
        </div>
    </div>

    <script>
        // Pretest logic - unchanged
        const options = document.querySelectorAll('.option');
        options.forEach(option => {
            option.addEventListener('click', () => {
                const parent = option.parentElement;
                const siblings = parent.querySelectorAll('.option');
                siblings.forEach(sib => {
                    sib.classList.remove('correct', 'incorrect');
                });
                if (option.dataset.correct === 'true') {
                    option.classList.add('correct');
                } else {
                    option.classList.add('incorrect');
                    siblings.forEach(sib => {
                        if (sib.dataset.correct === 'true') {
                            sib.classList.add('correct');
                        }
                    });
                }
            });
        });

        // Start Lab logic
        document.getElementById('startLabBtn').addEventListener('click', () => {
            document.querySelector('.pretest').style.display = 'none';
            document.getElementById('labSection').classList.add('show');
        });

        // Drag-and-drop logic (InteractJS)
        const leads = document.querySelectorAll('.lead');
        const dropZones = document.querySelectorAll('.drop-zone');
        let placedLeads = { ra: false, la: false, lf: false };

        // Place leads using interact.js
        leads.forEach(lead => {
            interact(lead).draggable({
                onmove: dragMoveListener,
                onend: (event) => {
                    const target = event.target;
                    const dropZone = document.elementFromPoint(event.clientX, event.clientY);
                    if (dropZone && dropZone.classList.contains('drop-zone') && dropZone.dataset.zone === target.dataset.lead) {
                        target.style.left = dropZone.offsetLeft + 'px';
                        target.style.top = dropZone.offsetTop + 'px';
                        target.style.transform = '';
                        target.setAttribute('data-x', 0);
                        target.setAttribute('data-y', 0);
                        placedLeads[target.dataset.lead] = true;
                        checkAllPlaced();
                    } else {
                        // Reset position if not placed correctly
                        target.style.left = '';
                        target.style.top = '';
                        target.style.transform = '';
                        target.setAttribute('data-x', 0);
                        target.setAttribute('data-y', 0);
                        placedLeads[target.dataset.lead] = false;
                    }
                }
            });
        });

        function dragMoveListener(event) {
            const target = event.target;
            const x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx;
            const y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;
            target.style.transform = `translate(${x}px, ${y}px)`;
            target.setAttribute('data-x', x);
            target.setAttribute('data-y', y);
        }

        function checkAllPlaced() {
            if (placedLeads.ra && placedLeads.la && placedLeads.lf) {
                updateAllCharts();
            }
        }

        // Chart.js ECG Simulation
        const charts = {};
        const leadsData = {
            aVR: { data: generateECGData('aVR'), color: 'rgba(0, 123, 255, 1)' },
            aVL: { data: generateECGData('aVL'), color: 'rgba(40, 167, 69, 1)' },
            aVF: { data: generateECGData('aVF'), color: 'rgba(23, 162, 184, 1)' }
        };

        function generateECGData(lead) {
            // basic ECG sim waveform
            const data = [];
            const length = 500;
            for (let i = 0; i < length; i++) {
                let value = 0;
                if (i > 50 && i < 60) value = 0.1;
                if (i > 80 && i < 90) value = -0.2;
                if (i > 90 && i < 110) value = 1.5;
                if (i > 110 && i < 120) value = -0.3;
                if (i > 130 && i < 150) value = 0.2;
                if (lead === 'aVR') value *= -1;
                data.push(value);
            }
            return data;
        }

        function updateAllCharts() {
            ['aVR', 'aVL', 'aVF'].forEach(lead => {
                const ctx = document.getElementById('chart-' + lead).getContext('2d');
                // Destroy previous chart if exists
                if (charts[lead]) {
                    charts[lead].destroy();
                }
                charts[lead] = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: Array(leadsData[lead].data.length).fill(''),
                        datasets: [{
                            label: lead + ' simulated ECG',
                            data: leadsData[lead].data,
                            borderColor: leadsData[lead].color,
                            borderWidth: 2,
                            pointRadius: 0,
                            fill: false
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: { legend: { display: false } },
                        scales: {
                            x: { display: false },
                            y: { min: -2, max: 2, display: false }
                        }
                    }
                });
            });
            document.getElementById('observations').textContent =
                'Leads placed: aVR – Negative QRS complex; aVL – Positive QRS; aVF – Positive QRS with inferior emphasis.';
        }
      // end script
    </script>
</body>
</html>
